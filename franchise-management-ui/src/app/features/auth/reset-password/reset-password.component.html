<div class="wrapper">
  <section class="card">
    <div class="brand">
      <div class="logo">FM</div>
      <h1>Restablecer contrasena</h1>
      <p>Introduce el token recibido y define una nueva contrasena segura.</p>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
      <label for="token">Token</label>
      <div class="token-row">
        <input
          id="token"
          type="text"
          formControlName="token"
          placeholder="token-uuid"
          [readonly]="tokenValid()"
          [class.invalid]="form.controls.token.invalid && form.controls.token.touched"
        />
        <button type="button" class="secondary" (click)="onValidateToken()" [disabled]="validatingToken() || tokenValid()">
          {{ validatingToken() ? 'Validando...' : tokenValid() ? 'Validado' : 'Validar token' }}
        </button>
      </div>

      <p class="alert info" *ngIf="tokenInfo()">{{ tokenInfo() }}</p>

      <fieldset [disabled]="passwordSectionDisabled()">
        <label for="password">Nueva contrasena</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          placeholder="********"
          [class.invalid]="form.controls.password.invalid && form.controls.password.touched"
        />

        <label for="confirmPassword">Confirma la contrasena</label>
        <input
          id="confirmPassword"
          type="password"
          formControlName="confirmPassword"
          placeholder="********"
          [class.invalid]="form.controls.confirmPassword.invalid && form.controls.confirmPassword.touched"
        />
      </fieldset>

      <button type="submit" class="primary" [disabled]="submitting()">
        {{ submitting() ? 'Actualizando...' : 'Restablecer contrasena' }}
      </button>
    </form>

    <p class="alert success" *ngIf="success()">
      {{ success() }}
      <br />
      <button type="button" class="secondary" (click)="goToLogin()">Ir al inicio de sesion</button>
    </p>

    <p class="alert error" *ngIf="error()">{{ error() }}</p>

    <div class="links">
      <a routerLink="/forgot-password">Solicitar un nuevo token</a>
      <a routerLink="/login">Volver al inicio de sesion</a>
    </div>
  </section>
</div>
